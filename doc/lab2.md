# Lab2

## Comments Handling

词法分析器支持 C 风格的块注释（`/* ... */`），具体实现如下：

- 当词法分析器遇到 `/*` 时，会进入一个特殊状态 `COMMENT`，并且增加一个计数器 `comment_level_`，用于追踪嵌套的注释。（`comment_level_`没有识别到注释的情况下初始为1）
- 支持嵌套注释：每当遇到一个新的 `/*`，计数器会增加；当遇到 `*/` 时，计数器减少。
- 当计数器为 1 时，遇到 `*/` 将退出注释模式，恢复到初始状态。
- 如果注释未闭合并到达文件末尾（`EOF`），此时还在特殊状态`COMMENT`中，将触发错误处理，报告“非法的注释结束”。

## String Handling

对于字符串字面量（使用双引号包围的文本），词法分析器进入 `STR` 状态并处理字符串内容，因为字符串需要进行一些转义的操作，所以用一个字符串缓冲区`string_buf_`来存储实际获取到的字符串内容，支持如下几种情形：

- 当遇到 `"` 时，表示字符串的开始或结束，进入或退出 `STR` 状态。
- 支持转义字符，包括 `\n`（换行符）、`\t`（制表符）、`\\`（反斜杠）、`\"`（双引号）等，对于这些转义字符，直接将他们替换为转义后对应的字符。
- 支持ASCII编码字符，`\123`这种形式表示ASCII编码值为123的字符，识别到这种形式之后将ASCII码的字符串转换为char类型的对象然后加入到`string_buf_`中。
- 支持控制字符，类似`\^A`这种形式的字符，表示`Ctrl-A`，这样的字符通过将`^`之后的字符减去`@`得到的值等于控制字符本身的ASCII码，用这个ASCII码来生成char类型对象然后加入到`string_buf_`中。
- 支持跨行字符串，在这种情况下，可以使用反斜杠 `\` 作为续行符，表示字符串在下一行继续。`\`之间的`\t`,`\n`,空格都可以忽略掉，词法分析器会跳过这部分，继续之后的内容。
- 对于其他普通字符，直接添加到`string_buf_`即可。
- 如果字符串未闭合且遇到 `EOF`，将触发错误处理，报告“非法的字符串结束”。

## Error Handling

错误处理主要用于以下几种情况：

- 非法字符：如果词法分析器遇到无法识别的字符或符号，调用 `errormsg_->Error()` 函数报告错误。
- 非法注释结束：在注释未闭合的情况下遇到 `EOF`，报告“非法的注释结束”错误。
- 非法字符串结束：在字符串未闭合的情况下遇到 `EOF`，报告“非法的字符串结束”错误。

## End-of-File Handling

词法分析器在处理到文件结束时，会根据上下文执行不同的操作：

- 在注释状态下遇到 `EOF` 会触发非法注释结束的错误。
- 在字符串状态下遇到 `EOF` 会触发非法字符串结束的错误。
- 在正常状态下遇到`EOF`表明正常结束

## Other Features

无。